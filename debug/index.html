<!DOCTYPE html>
<html>
<head>
    <title>Mapbox GL JS debug page</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel='stylesheet' href='../dist/mapbox-gl.css' />
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>

<body>
<div id='map'></div>

<script src='../dist/mapbox-gl.js'></script>
<script src='../debug/access_token_generated.js'></script>
<script>

mapboxgl.accessToken = 'pk.eyJ1Ijoid2xmZWkiLCJhIjoiY2puMTB6MXZlNHZjcTNwbnl3dnowYjhoaSJ9.s6ZkjRHGIY6xVNBRAf52MQ';

var map = window.map = new mapboxgl.Map({
    container: 'map',
    zoom: 1,
    center: [112.9713, 32.37203],
    style: {
        'version': 8,
        'sources': {
            'raster-tiles': {
                'type': 'raster',
                'tiles': [
                    'https://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=2db0ba5b3fa4414b2ea0ac2903d7519c'
                ],
                'tileSize': 256,
            }
        },
        'layers': [
            {
                'id': 'base-simple-tiles',
                'type': 'raster',
                'source': 'raster-tiles',
                'minzoom': 0,
                'maxzoom': 22
            }
        ]
    },
    crs:'EPSG:3857'
});

setTimeout(function(){
    map.switchProjection('EPSG:4326', (style) => {
        map.removeLayer('base-simple-tiles');
        map.removeSource('raster-tiles');

        map.addSource('raster-tiles',  {
            'type': 'raster',
            'tiles': [
                'https://t0.tianditu.gov.cn/DataServer?T=img_c&x={x}&y={y}&l={z}&tk=2db0ba5b3fa4414b2ea0ac2903d7519c'
            ],
            'tileSize': 256,
        });

        map.addLayer({
            'id': 'base-simple-tiles',
            'type': 'raster',
            'source': 'raster-tiles',
            'minzoom': 0,
            'maxzoom': 22
        }, 'polygon');
    });
}, 10000);

var marker = new mapboxgl.Marker()
.setLngLat([112.9713, 32.37203])
.addTo(map);

map.on('load', () => {
    map.addSource("points", {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': [[112.9713, 32.37203],[112.9713, 22.37203]]
            }
        }
    });
    
    map.addLayer({
        'id': 'polygon',
        'type': 'line',
        'source': 'points'
    });
});
</script>
</body>
</html>
